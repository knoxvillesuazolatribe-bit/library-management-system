<?php
require 'config.php';
session_start();
if (isset($_SESSION['user'])) {
    header('Location: dashboard.php');
    exit;
} else {
    header('Location: login.php');
    exit;
}
?>

<?php
require 'config.php';
session_start();
if (!isset($_SESSION['user'])) { header('Location: login.php'); exit; }

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (isset($_POST['issue'])) {
        $user_id = intval($_POST['user_id']);
        $book_id = intval($_POST['book_id']);
        $mysqli->query('INSERT INTO transactions (user_id,book_id) VALUES ('.$user_id.','.$book_id.')');
        header('Location: issue.php'); exit;
    } elseif (isset($_POST['return'])) {
        $tid = intval($_POST['transaction_id']);
        $mysqli->query('UPDATE transactions SET returned_at = NOW() WHERE id='.$tid);
        header('Location: issue.php'); exit;
    }
}

$transactions = $mysqli->query('SELECT t.*, u.username, b.title FROM transactions t JOIN users u ON u.id=t.user_id JOIN books b ON b.id=t.book_id ORDER BY t.issued_at DESC');
$users = $mysqli->query('SELECT id,username FROM users');
$books = $mysqli->query('SELECT id,title,copies FROM books');
?>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Issue / Return - Library</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
<?php include 'parts/nav.php'; ?>
<div class="container py-4">
  <h4>Issue / Return</h4>
  <div class="card p-3 mb-3">
    <form method="post" class="row g-2 align-items-end">
      <div class="col-md-4"><label>User</label><select name="user_id" class="form-select"><?php while($u=$users->fetch_assoc()): ?><option value="<?php echo $u['id']; ?>"><?php echo htmlspecialchars($u['username']); ?></option><?php endwhile; ?></select></div>
      <div class="col-md-4"><label>Book</label><select name="book_id" class="form-select"><?php while($b=$books->fetch_assoc()): ?><option value="<?php echo $b['id']; ?>"><?php echo htmlspecialchars($b['title']); ?></option><?php endwhile; ?></select></div>
      <div class="col-md-4"><button name="issue" class="btn btn-primary">Issue Book</button></div>
    </form>
  </div>

  <h5>Transactions</h5>
  <table class="table table-bordered">
    <thead><tr><th>User</th><th>Book</th><th>Issued At</th><th>Returned At</th><th>Action</th></tr></thead>
    <tbody>
      <?php while($t = $transactions->fetch_assoc()): ?>
      <tr>
        <td><?php echo htmlspecialchars($t['username']); ?></td>
        <td><?php echo htmlspecialchars($t['title']); ?></td>
        <td><?php echo $t['issued_at']; ?></td>
        <td><?php echo $t['returned_at'] ? $t['returned_at'] : '-'; ?></td>
        <td>
          <?php if(!$t['returned_at']): ?>
          <form method="post" style="display:inline"><input type="hidden" name="transaction_id" value="<?php echo $t['id']; ?>"><button name="return" class="btn btn-sm btn-success">Return</button></form>
          <?php else: ?>Returned<?php endif; ?>
        </td>
      </tr>
      <?php endwhile; ?>
    </tbody>
  </table>
</div>
</body>
</html>

<?php
require 'config.php';
session_start();
$err = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $u = $_POST['username'] ?? '';
    $p = $_POST['password'] ?? '';
    $stmt = $mysqli->prepare('SELECT id, username, password, role FROM users WHERE username = ?');
    $stmt->bind_param('s', $u);
    $stmt->execute();
    $res = $stmt->get_result()->fetch_assoc();
    if ($res && password_verify($p, $res['password'])) {
        $_SESSION['user'] = ['id'=>$res['id'],'username'=>$res['username'],'role'=>$res['role']];
        header('Location: dashboard.php');
        exit;
    } else {
        $err = 'Invalid credentials';
    }
}
?>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Login - Library</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
</head>
<body class="login-page">
<div class="container d-flex justify-content-center align-items-center" style="min-height:80vh">
  <div class="card p-4 shadow-sm" style="width:380px">
    <h4 class="mb-3 text-center">Library Login</h4>
    <?php if($err): ?><div class="alert alert-danger"><?php echo $err; ?></div><?php endif; ?>
    <form method="post">
      <div class="mb-2"><input name="username" class="form-control" placeholder="Username" required></div>
      <div class="mb-3"><input name="password" type="password" class="form-control" placeholder="Password" required></div>
      <div class="d-grid gap-2"><button class="btn btn-primary">Login</button></div>
    </form>
    <div class="mt-3 text-center">
      <a href="register.php">Create an account</a>
    </div>
  </div>
</div>
</body>
</html>

<?php
session_start();
session_destroy();
header('Location: login.php');
exit;
?>

# Library Management System
A simple Library Management System developed using PHP and MySQL.
## Features
- Dashboard
- Add, Edit, Delete Books
- Issue and Return Books
- MySQL Database Integration
- Logout System
## Tools Used
- XAMPP
- PHP
- MySQL
- VS Code
## Installation (local XAMPP)
1. Start Apache and MySQL in XAMPP.
2. Copy the project folder into `C:/xampp/htdocs/` (or your XAMPP `htdocs` folder).
3. Import `sql/library.sql` via phpMyAdmin to create the database and tables.
4. Edit `config.php` if your MySQL credentials differ (default: root, no password).
5. Open `http://localhost/xampp_library_system/` in your browser.

<?php
require 'config.php';
session_start();
$err = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $u = $_POST['username'] ?? '';
    $p = $_POST['password'] ?? '';
    if (strlen($p) < 4) { $err = 'Password must be at least 4 characters.'; }
    else {
        $hash = password_hash($p, PASSWORD_DEFAULT);
        $stmt = $mysqli->prepare('INSERT INTO users (username,password,role) VALUES (?,?,?)');
        $role = 'user';
        $stmt->bind_param('sss',$u,$hash,$role);
        if ($stmt->execute()) {
            header('Location: login.php');
            exit;
        } else {
            $err = 'Could not create user (maybe username taken).';
        }
    }
}
?>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Register - Library</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
</head>
<body class="login-page">
<div class="container d-flex justify-content-center align-items-center" style="min-height:80vh">
  <div class="card p-4 shadow-sm" style="width:380px">
    <h4 class="mb-3 text-center">Create Account</h4>
    <?php if($err): ?><div class="alert alert-danger"><?php echo $err; ?></div><?php endif; ?>
    <form method="post">
      <div class="mb-2"><input name="username" class="form-control" placeholder="Username" required></div>
      <div class="mb-3"><input name="password" type="password" class="form-control" placeholder="Password" required></div>
      <div class="d-grid gap-2"><button class="btn btn-primary">Register</button></div>
    </form>
    <div class="mt-3 text-center">
      <a href="login.php">Back to login</a>
    </div>
  </div>
</div>
</body>
</html>

<?php
require 'config.php';
session_start();
if (!isset($_SESSION['user'])) { header('Location: login.php'); exit; }

$action = $_GET['action'] ?? '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (isset($_POST['add'])) {
        $title = $_POST['title']; $author = $_POST['author']; $isbn = $_POST['isbn']; $copies = intval($_POST['copies']);
        $stmt = $mysqli->prepare('INSERT INTO books (title,author,isbn,copies) VALUES (?,?,?,?)');
        $stmt->bind_param('sssi',$title,$author,$isbn,$copies); $stmt->execute();
        header('Location: books.php'); exit;
    } elseif (isset($_POST['edit'])) {
        $id = intval($_POST['id']); $title = $_POST['title']; $author = $_POST['author']; $isbn = $_POST['isbn']; $copies = intval($_POST['copies']);
        $stmt = $mysqli->prepare('UPDATE books SET title=?,author=?,isbn=?,copies=? WHERE id=?');
        $stmt->bind_param('sssii',$title,$author,$isbn,$copies,$id); $stmt->execute();
        header('Location: books.php'); exit;
    }
}
if ($action === 'delete') {
    $id = intval($_GET['id']);
    $mysqli->query('DELETE FROM books WHERE id='.$id);
    header('Location: books.php'); exit;
}
$books = $mysqli->query('SELECT * FROM books ORDER BY created_at DESC');
?>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Books - Library</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
<?php include 'parts/nav.php'; ?>
<div class="container py-4">
  <div class="d-flex justify-content-between mb-3">
    <h4>Books</h4>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">Add Book</button>
  </div>
  <table class="table table-striped">
    <thead><tr><th>Title</th><th>Author</th><th>ISBN</th><th>Copies</th><th>Actions</th></tr></thead>
    <tbody>
      <?php while($b = $books->fetch_assoc()): ?>
      <tr>
        <td><?php echo htmlspecialchars($b['title']); ?></td>
        <td><?php echo htmlspecialchars($b['author']); ?></td>
        <td><?php echo htmlspecialchars($b['isbn']); ?></td>
        <td><?php echo $b['copies']; ?></td>
        <td>
          <a href="books.php?action=edit&id=<?php echo $b['id']; ?>" class="btn btn-sm btn-outline-primary">Edit</a>
          <a href="books.php?action=delete&id=<?php echo $b['id']; ?>" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete?')">Delete</a>
        </td>
      </tr>
      <?php endwhile; ?>
    </tbody>
  </table>
</div>

<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form method="post">
      <div class="modal-header"><h5 class="modal-title">Add Book</h5></div>
      <div class="modal-body">
        <input name="title" class="form-control mb-2" placeholder="Title" required>
        <input name="author" class="form-control mb-2" placeholder="Author">
        <input name="isbn" class="form-control mb-2" placeholder="ISBN">
        <input name="copies" type="number" class="form-control" placeholder="Copies" value="1" min="1">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button name="add" class="btn btn-primary">Add</button>
      </div>
    </form>
  </div></div>
</div>

<!-- Edit handling -->
<?php if($action === 'edit' && isset($_GET['id'])):
    $id = intval($_GET['id']);
    $row = $mysqli->query('SELECT * FROM books WHERE id='.$id)->fetch_assoc();
?>
<div class="container py-3">
  <div class="card p-3">
    <h5>Edit Book</h5>
    <form method="post">
      <input type="hidden" name="id" value="<?php echo $row['id']; ?>">
      <input name="title" class="form-control mb-2" value="<?php echo htmlspecialchars($row['title']); ?>" required>
      <input name="author" class="form-control mb-2" value="<?php echo htmlspecialchars($row['author']); ?>">
      <input name="isbn" class="form-control mb-2" value="<?php echo htmlspecialchars($row['isbn']); ?>">
      <input name="copies" type="number" class="form-control mb-2" value="<?php echo $row['copies']; ?>" min="1">
      <div class="d-flex"><a href="books.php" class="btn btn-secondary me-2">Cancel</a><button name="edit" class="btn btn-primary">Save</button></div>
    </form>
  </div>
</div>
<?php endif; ?>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<?php
$DB_HOST = 'localhost';
$DB_USER = 'root';
$DB_PASS = '';
$DB_NAME = 'library_system';

$mysqli = new mysqli($DB_HOST, $DB_USER, $DB_PASS);

// On first run, create database if not exists
if ($mysqli->connect_error) {
    die('DB connect error: ' . $mysqli->connect_error);
}
$mysqli->query("CREATE DATABASE IF NOT EXISTS `{$DB_NAME}`");
$mysqli->select_db($DB_NAME);

// helper function
function esc($s){ return htmlspecialchars(trim($s)); }
?>

<?php
require 'config.php';
session_start();
if (!isset($_SESSION['user'])) { header('Location: login.php'); exit; }
$user = $_SESSION['user'];
?>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dashboard - Library</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="dashboard.php">Library</a>
    <div class="ms-auto text-white">Hello, <?php echo htmlspecialchars($user['username']); ?> &nbsp; <a href="logout.php" class="btn btn-outline-light btn-sm">Logout</a></div>
  </div>
</nav>
<div class="container py-4">
  <div class="row">
    <div class="col-md-3">
      <div class="list-group">
        <a href="dashboard.php" class="list-group-item list-group-item-action active">Dashboard</a>
        <a href="books.php" class="list-group-item list-group-item-action">Books</a>
        <a href="issue.php" class="list-group-item list-group-item-action">Issue / Return</a>
      </div>
    </div>
    <div class="col-md-9">
      <h4>Overview</h4>
      <?php
      $books = $mysqli->query("SELECT COUNT(*) as c FROM books")->fetch_assoc()['c'];
      $users = $mysqli->query("SELECT COUNT(*) as c FROM users")->fetch_assoc()['c'];
      $issued = $mysqli->query("SELECT COUNT(*) as c FROM transactions WHERE returned_at IS NULL")->fetch_assoc()['c'];
      ?>
      <div class="row">
        <div class="col-md-4"><div class="card p-3"><h5>Books</h5><p><?php echo $books; ?></p></div></div>
        <div class="col-md-4"><div class="card p-3"><h5>Users</h5><p><?php echo $users; ?></p></div></div>
        <div class="col-md-4"><div class="card p-3"><h5>Issued</h5><p><?php echo $issued; ?></p></div></div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
